---
import Base from "../../layouts/base.astro";
import { getCollection } from "astro:content";
import { withBase } from "../../lib/withBase";

export async function getStaticPaths() {
  const stores = await getCollection("stores");
  return stores.map((s) => ({ params: { slug: s.slug } }));
}

const stores = await getCollection("stores");
const store = stores.find((s) => s.slug === Astro.params.slug);
if (!store) {
  throw new Error(`Store not found: ${Astro.params.slug}`);
}

const { Content } = await store.render();
---

<Base title={`${store.data.name} — Beanfreaks`} description={`Opening times, phone, and directions for ${store.data.name}.`}>
  <div class="flex flex-col gap-2">
    <a class="text-sm text-slate-600 hover:underline" href={withBase("stores/")}>← All stores</a>
    <h1 class="text-3xl font-semibold tracking-tight">{store.data.name}</h1>
    <p class="text-slate-700">{store.data.address}</p>
  </div>

  <div class="mt-6 grid gap-6 md:grid-cols-12">
    <section class="md:col-span-7">
      <article class="prose prose-slate max-w-none">
        <Content />
      </article>
    </section>

    <aside class="md:col-span-5">
      <div class="rounded-2xl border border-slate-200 p-5 shadow-sm">
        <h2 class="text-lg font-semibold tracking-tight">Contact</h2>
        <p class="mt-2 text-sm text-slate-700"><span class="font-medium">Phone:</span> {store.data.phone}</p>
        <p class="mt-1 text-sm text-slate-700"><span class="font-medium">Hours:</span> {store.data.hours_summary}</p>
        <p class="mt-4 text-sm">
          <a class="font-semibold hover:underline" href={store.data.map_url} target="_blank" rel="noreferrer">Open in maps →</a>
        </p>
      </div>

      {store.data.hours?.length ? (
        <div class="mt-5 rounded-2xl border border-slate-200 p-5">
          <h2 class="text-lg font-semibold tracking-tight">Opening times</h2>
          <dl class="mt-3 grid gap-2 text-sm">
            {store.data.hours.map((h) => (
              <div class="flex items-center justify-between gap-4">
                <dt class="text-slate-600">{h.day}</dt>
                <dd class="font-medium text-slate-900">{h.open}–{h.close}</dd>
              </div>
            ))}
          </dl>
        </div>
      ) : null}
    </aside>
  </div>
</Base>
